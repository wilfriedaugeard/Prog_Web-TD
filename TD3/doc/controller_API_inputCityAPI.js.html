<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controller/API/inputCityAPI.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controller/API/inputCityAPI.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * The InputCityAPI class is used to manage autocompletion on city name.
 * @class
 */
class InputCityAPI {
	/**
	 * Create an InputCityAPI instance with public key.
	 * @param {App} app - The main App instance. 
	 */
	constructor(app){
		this.app = app;
		this.key = 'woos-81a699ca-5082-3ffd-9f54-a684a4b82853';
	}
	/**
	 * Active input city listener.
	 */
	activeListener(){
		(key => {
			let previousSearch = '';
			let autocompleteService = new woosmap.localities.AutocompleteService(key);
			const inputLocalities = document.getElementById("inputCity");
			function renderPredictions({localities}, app) {
				let results = document.querySelector('.predictions');
				results.innerHTML = '';
				for (let prediction_id in localities || []) {
					if (localities.hasOwnProperty(prediction_id)) {
						let prediction = localities[prediction_id];
						let formatted_name = prediction['description'];
						let listElementLocality = document.createElement('li');
						listElementLocality.setAttribute('class', 'prediction');
						listElementLocality.setAttribute('id', prediction_id);
						listElementLocality.textContent = formatted_name;
						listElementLocality.addEventListener('click', event => {
							results.style.display = 'none';
							inputLocalities.value = prediction.description;
							const jsonData = prediction;
							app.inputDataTreatment(jsonData);
						});
						results.appendChild(listElementLocality);
					}
				}
				if(results.childElementCount == 0){
					let notFound = document.createElement('li');
					notFound.setAttribute('class', 'prediction');
					notFound.textContent = 'Aucunes villes ne correspond';
					results.appendChild(notFound);
				}
				results.style.display = 'block';
					
			}

			const that = this;
			inputLocalities.addEventListener("keyup", function (e) {
				const input = inputLocalities.value;
				if (input !== previousSearch) {
					previousSearch = input;
					let selectedItem = document.getElementById('selected-locality');
					if (inputLocalities.value.length === 0) {
						document.querySelector('.predictions').innerHTML = ''
					}
					selectedItem.innerHTML = '';
					const components = {country: 'fr'};
					autocompleteService.getQueryPredictions({
							input, components
						}, response => {
							renderPredictions(response, that.app);
						},
						(errorCode, errorText) => {
							console.error(`error ${errorCode} : ${errorText}`)
						}
					);
				}
				if(input === ''){
					const results = document.querySelector('.predictions');
					results.style.display = 'none';
				}
			});
		})(this.key);
	}
}

export default InputCityAPI;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="City.html">City</a></li><li><a href="CityHtmlBuilder.html">CityHtmlBuilder</a></li><li><a href="Data.html">Data</a></li><li><a href="GoogleMapAPI.html">GoogleMapAPI</a></li><li><a href="InputCityAPI.html">InputCityAPI</a></li><li><a href="Main.html">Main</a></li><li><a href="MapGeoloc.html">MapGeoloc</a></li><li><a href="WeatherAPI.html">WeatherAPI</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Oct 15 2020 19:17:22 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
